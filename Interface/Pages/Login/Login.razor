@page "/Login"
@using BusinessLogic
@using DepoQuick.Domain
@using Blazorise
@using DepoQuick.Domain.Exceptions.ControllerExceptions
@using DepoQuick.Domain.Exceptions.MemoryDataBaseExceptions
@inject MemoryDataBase MemoryDataBase
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager


<html lang="es" xmlns="http://www.w3.org/1999/html">
  <head>
      <meta charset="utf-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  </head>

<body>

@if (_showAlertUserDoesNotExist)
{
  <br>
   <div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">El usuario ingresado no existe</h4>
  </div>
  <br>
}

@if (_showAlertInvalidPassword)
{
  <br>
   <div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">La contraseña ingresada no es válida</h4>
  </div>
  <br>
}

<h3>¡Bienvenido!</h3>
<form>
    <div class="form-group">
        <label for="email">Correo Electrónico:</label>
        <input type="email" class="form-control" id="email" @bind-value="_email" required/>
    </div>
    <div class="form-group">
        <label for="password">Contraseña:</label>
        <input type="password" class="form-control" id="password" @bind-value="_password"required/>
    </div>
    <br><br/>
    <button type="button" class="btn btn-primary" @onclick="ShowAlert">Login</button>
</form>
</body>
</html>

@code {
    bool logged = false;
    private bool _showAlertUserDoesNotExist;
    private bool _showAlertInvalidPassword;
    private Controller _controller;
    private String _email;
    private String _password;
    private User _loggedUser;

    
    
     protected override void OnInitialized()
    {
        _controller = new Controller(MemoryDataBase);
    }
        
    public void LoginUser()
    {
        _controller.LoginUser(_email,_password);
        logged = true;
        NavigationManager.NavigateTo("/Home",forceLoad: true);
    }
    
    private void ShowAlert()
    {
        HideAllAlerts();
        try
        {
            _controller.LoginUser(_email, _password); //estas logeandote aca, logearse una sola vez
            LoginUser();
        }
        catch (UserDoesNotExistException userDoesNotExistException)
        {
            _showAlertUserDoesNotExist = true;
        }
        catch (UserPasswordIsInvalidException userPasswordIsInvalidException)
        {
            _showAlertInvalidPassword = true;
        }
        
    }
    
    private void HideAllAlerts()
    {
        _showAlertUserDoesNotExist = false;
        _showAlertInvalidPassword = false;
    }
    
}